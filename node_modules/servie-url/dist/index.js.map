{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":";;AACA,6BAA0B;AAG1B,MAAM,GAAG,GAAG,IAAI,OAAO,EAA2B,CAAC;AAEnD;;GAEG;AACH,SAAS,KAAK,CAAC,GAAW;IACxB,OAAO,IAAI,SAAG,CAAC,GAAG,EAAE,kBAAkB,CAAC,CAAC;AAC1C,CAAC;AAED;;GAEG;AACH,SAAgB,MAAM,CAAC,GAAkB;IACvC,MAAM,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC;IACpB,MAAM,KAAK,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAE3B,IAAI,CAAC,KAAK,EAAE;QACV,MAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;QACvB,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;QAC3B,OAAO,GAAG,CAAC;KACZ;IAED,IAAI,KAAK,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG;QAAE,OAAO,KAAK,CAAC,GAAG,CAAC;IAE5C,MAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;IACvB,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;IAC3B,OAAO,GAAG,CAAC;AACb,CAAC;AAfD,wBAeC","sourcesContent":["import { CommonRequest } from \"servie/dist/common\";\nimport { URL } from \"url\";\n\ntype URLCache = { url: string; URL: URL };\nconst map = new WeakMap<CommonRequest, URLCache>();\n\n/**\n * Parse pathname from request url.\n */\nfunction toURL(url: string) {\n  return new URL(url, \"http://localhost\");\n}\n\n/**\n * Parse pathname from request instance.\n */\nexport function getURL(req: CommonRequest): URL {\n  const { url } = req;\n  const cache = map.get(req);\n\n  if (!cache) {\n    const URL = toURL(url);\n    map.set(req, { url, URL });\n    return URL;\n  }\n\n  if (cache.url === req.url) return cache.URL;\n\n  const URL = toURL(url);\n  map.set(req, { URL, url });\n  return URL;\n}\n"]}